# Udev rule to allow amc_pci to be world readable and to create geographic
# ids.  This udev file works on RHEL7.

# Copy this file to /etc/udev/rules.d

# Start by giving full device access to comp group.
SUBSYSTEM=="amc_pci", GROUP="@@DRV_GROUP@@", MODE="0660"

# Now create geographical addresses.  We have to be bit tricky here to get the
# right device names, as we don't want the rather arbitrary sequence number
# generated by the kernel.
#     Unfortunately our mapping from minor to node name is a bit tricksy, so we
# have to used a bit of shell script to do the mapping.  If udev rules could be
# on multiple lines this would read:
#
#   SUBSYSTEM=="amc_pci",
#       PROGRAM="/bin/sh -c '
#           k=%k;                       # Original name from driver
#           echo ${k##*.}'",            # Strip off all but the last part
#       IMPORT{builtin}="path_id",      # Defines ID_PATH
#       SYMLINK+="amc_pci/$env{ID_PATH}/amc_pci.%c"

SUBSYSTEM=="amc_pci", PROGRAM="/bin/sh -c 'k=%k; echo ${k##*.}'", IMPORT{builtin}="path_id", SYMLINK+="amc_pci/$env{ID_PATH}/amc_pci.%c"

# vim: set filetype=udevrules:
